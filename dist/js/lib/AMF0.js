!function(){var e=!0;function t(){if(e){var t,r,i=[];for(t=0,r=arguments.length;t<r;t++)arguments[t],i[t]=arguments[t],t!=r-1&&", ";"\n",postMessage({type:"debug",message:i})}}var r=t;AMF0=function(){this.readObjectCache=[],this._rawData,this._data,this._amf3},AMF0.prototype={NUMBER_TYPE:0,BOOLEAN_TYPE:1,STRING_TYPE:2,OBJECT_TYPE:3,MOVIECLIP_TYPE:4,NULL_TYPE:5,UNDEFINED_TYPE:6,REFERENCE_TYPE:7,ECMA_ARRAY_TYPE:8,OBJECT_END_TYPE:9,STRICT_ARRAY_TYPE:10,DATE_TYPE:11,LONG_STRING_TYPE:12,UNSUPPORTED_TYPE:13,RECORD_SET_TYPE:14,XML_OBJECT_TYPE:15,TYPED_OBJECT_TYPE:16,AVMPLUS_OBJECT_TYPE:17,MAX_STORED_OBJECTS:1024,EMPTY_STRING:"",deserialize:function(e){this.reset(),this._rawData=e,this._data=this.readData(this._rawData)},reset:function(){this.readObjectCache=[],null!=this._amf3&&this._amf3.reset()},readData:function(e,i){switch(null==i&&(i=e.readByte()),i){case this.NUMBER_TYPE:return this.readNumber(e);case this.BOOLEAN_TYPE:return this.readBoolean(e);case this.STRING_TYPE:return this.readString(e);case this.OBJECT_TYPE:return this.readObject(e);case this.NULL_TYPE:return this.readNull(e);case this.UNDEFINED_TYPE:return this.readUndefined(e);case this.REFERENCE_TYPE:return console.log("REFERENCE_TYPE",e.endian,e.position),this.getObjectReference(e.readUnsignedShort());case this.ECMA_ARRAY_TYPE:return this.readECMAArray(e);case this.OBJECT_END_TYPE:return t("AMF0::readData - Warning : Unexpected object end tag in AMF stream"),this.readNull(e);case this.STRICT_ARRAY_TYPE:return this.readArray(e);case this.DATE_TYPE:return this.readDate(e);case this.LONG_STRING_TYPE:return this.readLongString(e);case this.UNSUPPORTED_TYPE:return t("AMF0::readData - Warning : Unsupported type found in AMF stream"),this.readNull(e);case this.RECORD_SET_TYPE:return t("AMF0::readData - Warning : Unexpected recordset in AMF stream"),this.readNull(e);case this.XML_OBJECT_TYPE:return this.readXML(e);case this.TYPED_OBJECT_TYPE:return this.readTypedObject(e);case this.AVMPLUS_OBJECT_TYPE:return null==this._amf3&&(this._amf3=new AMF3),this._amf3.readData(e);default:r("AMF0::readData - Error : Undefined AMF0 type encountered '"+i+"'")}},writeData:function(e,r){var i=r.__traits.type;switch(r.__traits.hasOwnProperty("origType")&&(i=r.__traits.origType),t("writeData "+i,r.value),i){case"Undefined":this.writeUndefined(e);break;case"Null":this.writeNull(e);break;case"Boolean":this.writeBoolean(e,r.value);break;case"Integer":case"Number":this.writeNumber(e,r.value);break;case"String":this.writeString(e,r.value);break;case"LongString":this.writeLongString(e,r.value);break;case"Date":this.writeDate(e,r.value);break;case"Array":this.writeArray(e,r.value);break;case"ECMAArray":this.writeECMAArray(e,r.value);break;case"Object":"Object"==r.__traits.class?this.writeObject(e,r.value,r.__traits):this.writeTypedObject(e,r.value,r.__traits);break;case"XML":this.writeXML(e,r.value);break;default:throw Error("Undefined AMF0 type encountered '"+i+"'")}},readNumber:function(e){return{value:e.readDouble(),__traits:{type:"Number"}}},writeNumber:function(e,t){e.writeByte(this.NUMBER_TYPE),e.writeDouble(t)},readBoolean:function(e){return{value:e.readBoolean(),__traits:{type:"Boolean"}}},writeBoolean:function(e,t){e.writeByte(this.BOOLEAN_TYPE),e.writeBoolean(t)},readString:function(e){return{value:e.readUTF(),__traits:{type:"String"}}},writeString:function(e,t){t.length<65536?(e.writeByte(this.STRING_TYPE),e.writeUTF(t)):this.writeLongString(e,t)},readObject:function(e,t){for(var r,i={},a=e.readUTF(),n=e.readByte();a.length>0&&n!=this.OBJECT_END_TYPE;)i[a]=this.readData(e,n),a=e.readUTF(),n=e.readByte();return t?i:(r={value:i,__traits:{type:"Object"}},this.readObjectCache.push(r),r)},writeObject:function(e,t,r,i){if(i||this.setObjectReference(e,t)){for(var a in void 0===i&&e.writeByte(this.OBJECT_TYPE),t)e.writeUTF(a),this.writeData(e,t[a]);e.writeUTF(this.EMPTY_STRING),e.writeByte(this.OBJECT_END_TYPE)}},readNull:function(e){return{value:null,__traits:{type:"Null"}}},writeNull:function(e){e.writeByte(this.NULL_TYPE)},readUndefined:function(e){return{value:null,__traits:{type:"Undefined"}}},writeUndefined:function(e){e.writeByte(this.UNDEFINED_TYPE)},readECMAArray:function(e){for(var t,r={},i=(e.readUnsignedInt(),e.readUTF()),a=e.readByte();i.length>0&&a!=this.OBJECT_END_TYPE;)r[i]=this.readData(e,a),i=e.readUTF(),a=e.readByte();return t={value:r,__traits:{type:"ECMAArray"}},this.readObjectCache.push(t),t},writeECMAArray:function(e,r){if(t("writeECMAArray"),this.setObjectReference(e,r)){var i,a=0;for(i in e.writeByte(this.ECMA_ARRAY_TYPE),r)isNaN(i)||a++;for(i in e.writeUnsignedInt(a),r)e.writeUTF(i),this.writeData(e,r[i]);e.writeByte(0),e.writeByte(0),e.writeByte(this.OBJECT_END_TYPE)}},readArray:function(e){var t,r,i=e.readUnsignedInt(),a=new Array(i);for(t=0;t<i;++t)a[t]=this.readData(e);return r={value:a,__traits:{type:"Array",strict:!0}},this.readObjectCache.push(r),r},writeArray:function(e,t){if(this.setObjectReference(e,t)){var r,i=t.length;for(e.writeByte(this.STRICT_ARRAY_TYPE),e.writeInt(i),r=0;r<i;++r)this.writeData(e,t[r])}},readDate:function(e){var t=e.readDouble();e.readShort();return{value:new Date(t),__traits:{type:"Date"}}},writeDate:function(e,t){e.writeByte(this.DATE_TYPE),t instanceof Date||(t=new Date(t)),e.writeDouble(t.getTime()),e.writeShort(t.getTimezoneOffset())},readLongString:function(e){return{value:e.readUTFBytes(e.readUnsignedInt()),__traits:{type:"LongString"}}},writeLongString:function(e,t){t.length<65536?this.writeString(e,t):(e.writeByte(this.LONG_STRING_TYPE),e.writeUnsignedInt(t.length),e.writeUTFBytes(t))},readXML:function(e){return{value:this.readLongString(e).value,__traits:{type:"XML"}}},writeXML:function(e,t){if(this.setObjectReference(e,t)){e.writeByte(this.XML_OBJECT_TYPE);var r=t.toString();r=r.replace(/^\s+|\s+$/g,""),e.writeUnsignedInt(r.length),e.writeUTFBytes(r)}},readTypedObject:function(e){var i,a,n=e.readUTF();try{i=this.readObject(e,!0)}catch(e){r("AMF0::readTypedObject - Error : Cannot parse custom class")}return t("readTypedObject"),t(i),t(n),a={value:i,__traits:{type:"Object",class:n}},this.readObjectCache.push(a),a},writeTypedObject:function(e,r,i){t("writeTypedObject"),t(i),t(r),this.setObjectReference(e,r)&&(e.writeByte(this.TYPED_OBJECT_TYPE),e.writeUTF(i.class),this.writeObject(e,r,i,!0))},getObjectReference:function(e){return e>=this.readObjectCache.length?(r("AMF0::getObjectReference - Error : Undefined object reference '"+e+"'"),null):(t("getObjectReference",e,this.readObjectCache),this.readObjectCache[e])},setObjectReference:function(e,t){return!0},writeUnsignedShort:function(e,t){var r=t/256,i=t%256;e.writeByte(i),e.writeByte(r)},writeUnsupported:function(e){e.writeByte(this.UNSUPPORTED_TYPE)}}}();