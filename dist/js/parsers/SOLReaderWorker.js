!function(){importScripts("https://cdn.mariani.life/projects/minerva/js/lib/ByteArray.js","https://cdn.mariani.life/projects/minerva/js/lib/AMF0.js","https://cdn.mariani.life/projects/minerva/js/lib/AMF3.js");var e=new AMF0,t=new AMF3,a=!1;function n(){if(a){for(var e=[],t=0,n=arguments.length;t<n;t++)e[t]=arguments[t];postMessage({type:"debug",message:e})}}var i={};i[-1]={name:"Header",func:r},i[2]={name:"LSO",func:function(a){if(this.header=new r(a),"TCSO"!=a.readUTFBytes(4))throw"Missing TCSO signature, not a SOL file";a.readUTFBytes(6),this.header.fileName=a.readUTFBytes(a.readUnsignedShort()),this.header.amfVersion=a.readUnsignedInt(),0===this.header.amfVersion||3===this.header.amfVersion?"undefined"==this.header.fileName&&(this.header.fileName="[SOL Name not Set]"):this.header.fileName="[Unsupported SOL format]";if(0==this.header.amfVersion||3==this.header.amfVersion)for(this.body={};a.getBytesAvailable()>1&&a.position<this.header.contentLength;){var n,i="";3==this.header.amfVersion?(i=t.readString(a).value,n=t.readData(a)):(i=a.readUTF(),n=e.readData(a)),a.readUnsignedByte(),this.body[i]=n}}},i[3]={name:"FilePath",func:function(e){this.header=new r(e),this.filePath=e.readUTFBytes(e.readUnsignedShort(),!0)}};var s={Header:-1,LSO:2,FilePath:3};function r(e){if(e){var t=e.position;this.tagTypeAndLength=e.readUI16(),this.contentLength=63&this.tagTypeAndLength,63==this.contentLength&&(this.contentLength=e.readSI32()),this.type=this.tagTypeAndLength>>6,this.headerLength=e.position-t,this.tagLength=this.headerLength+this.contentLength,this.name=i[this.type]?i[this.type].name:"?"}}onmessage=function(a){var h,o=a.data.fileID,d=new ByteArray(a.data.text,ByteArray.BIG_ENDIAN);e.reset(),t.reset(),h=function(e){var t=e.position,a={},h=new r(e);for(e.position=t;h;){var o=i[h.type];if(o){var d="LOG - "+e.position+" - "+i[h.type].name+" ("+h.type+") - "+h.contentLength,g=new o.func(e,a);switch(n(d,g),h.type){case s.LSO:a.header=g.header,a.body=g.body;break;case s.FilePath:a.flex=g}0!=h.tagLength-(e.position-t)&&n("Error reading "+i[h.type].name+" tag! Start:"+t+" End:"+e.position+" BytesAvailable:"+(h.tagLength-(e.position-t)),g),e.seek(h.tagLength-(e.position-t))}else n("Unknown tag type",h.type),e.seek(h.tagLength);if(e.getBytesAvailable()<=0)break;t=e.position,h=new r(e),e.position=t}return a}(d),postMessage({fileID:o,data:h})}}();