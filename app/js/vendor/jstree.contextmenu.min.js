!function(e){"use strict";"function"==typeof define&&define.amd?define("jstree.contextmenu",["jquery","jstree"],e):"object"==typeof exports?e(require("jquery"),require("jstree")):e(jQuery,jQuery.jstree)}(function(e,t,a){"use strict";e.jstree.plugins.contextmenu||(e.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(t){var a=e.jstree.reference(t.reference),n=a.get_node(t.reference);a.create_node(n,{},"last",function(e){setTimeout(function(){a.edit(e)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(t){var a=e.jstree.reference(t.reference),n=a.get_node(t.reference);a.edit(n)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(t){var a=e.jstree.reference(t.reference),n=a.get_node(t.reference);a.delete_node(a.is_selected(n)?a.get_selected():n)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(t){var a=e.jstree.reference(t.reference),n=a.get_node(t.reference);a.cut(a.is_selected(n)?a.get_selected():n)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(t){var a=e.jstree.reference(t.reference),n=a.get_node(t.reference);a.copy(a.is_selected(n)?a.get_selected():n)}},paste:{separator_before:!1,icon:!1,_disabled:function(t){return!e.jstree.reference(t.reference).can_paste()},separator_after:!1,label:"Paste",action:function(t){var a=e.jstree.reference(t.reference),n=a.get_node(t.reference);a.paste(n)}}}}}}},e.jstree.plugins.contextmenu=function(t,n){this.bind=function(){n.bind.call(this);var t=0;this.element.on("contextmenu.jstree",".jstree-anchor",e.proxy(function(e){e.preventDefault(),t=e.ctrlKey?e.timeStamp:0,this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(a){this._data.contextmenu.visible&&(!t||a.timeStamp-t>250)&&e.vakata.context.hide()},this)),e(document).on("context_hide.vakata.jstree",e.proxy(function(){this._data.contextmenu.visible=!1},this))},this.teardown=function(){this._data.contextmenu.visible&&e.vakata.context.hide(),n.teardown.call(this)},this.show_contextmenu=function(t,n,o,i){if(t=this.get_node(t),!t||"#"===t.id)return!1;var s=this.settings.contextmenu,r=this.get_node(t,!0),c=r.children(".jstree-anchor"),l=!1,d=!1;(s.show_at_node||n===a||o===a)&&(l=c.offset(),n=l.left,o=l.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(t)&&this.activate_node(t,i),d=s.items,e.isFunction(d)&&(d=d.call(this,t,e.proxy(function(e){this._show_contextmenu(t,n,o,e)},this))),e.isPlainObject(d)&&this._show_contextmenu(t,n,o,d)},this._show_contextmenu=function(t,a,n,o){var i=this.get_node(t,!0),s=i.children(".jstree-anchor");e(document).one("context_show.vakata.jstree",e.proxy(function(t,a){var n="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";e(a.element).addClass(n)},this)),this._data.contextmenu.visible=!0,e.vakata.context.show(s,{x:a,y:n},o),this.trigger("show_contextmenu",{node:t,x:a,y:n})}},function(e){var t=!1,a={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};e.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(t){e(document).triggerHandler("context_"+t+".vakata",{reference:a.reference,element:a.element,position:{x:a.position_x,y:a.position_y}})},_execute:function(t){return t=a.items[t],t&&(!t._disabled||e.isFunction(t._disabled)&&!t._disabled({item:t,reference:a.reference,element:a.element}))&&t.action?t.action.call(null,{item:t,reference:a.reference,element:a.element,position:{x:a.position_x,y:a.position_y}}):!1},_parse:function(t,n){if(!t)return!1;n||(a.html="",a.items=[]);var o,i="",s=!1;return n&&(i+="<ul>"),e.each(t,function(t,n){return n?(a.items.push(n),!s&&n.separator_before&&(i+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"),s=!1,i+="<li class='"+(n._class||"")+(n._disabled===!0||e.isFunction(n._disabled)&&n._disabled({item:n,reference:a.reference,element:a.element})?" vakata-contextmenu-disabled ":"")+"' "+(n.shortcut?" data-shortcut='"+n.shortcut+"' ":"")+">",i+="<a href='#' rel='"+(a.items.length-1)+"'>",e.vakata.context.settings.icons&&(i+="<i ",n.icon&&(i+=-1!==n.icon.indexOf("/")||-1!==n.icon.indexOf(".")?" style='background:url(\""+n.icon+"\") center center no-repeat' ":" class='"+n.icon+"' "),i+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),i+=(e.isFunction(n.label)?n.label({item:t,reference:a.reference,element:a.element}):n.label)+(n.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+n.shortcut+'">'+(n.shortcut_label||"")+"</span>":"")+"</a>",n.submenu&&(o=e.vakata.context._parse(n.submenu,!0),o&&(i+=o)),i+="</li>",void(n.separator_after&&(i+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",s=!0))):!0}),i=i.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),n&&(i+="</ul>"),n||(a.html=i,e.vakata.context._trigger("parse")),i.length>10?i:!1},_show_submenu:function(a){if(a=e(a),a.length&&a.children("ul").length){var n=a.children("ul"),o=a.offset().left+a.outerWidth(),i=a.offset().top,s=n.width(),r=n.height(),c=e(window).width()+e(window).scrollLeft(),l=e(window).height()+e(window).scrollTop();t?a[o-(s+10+a.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):a[o+s+10>c?"addClass":"removeClass"]("vakata-context-right"),i+r+10>l&&n.css("bottom","-1px"),n.show()}},show:function(n,o,i){var s,r,c,l,d,u,h,f,v=!0;switch(a.element&&a.element.length&&a.element.width(""),v){case!o&&!n:return!1;case!!o&&!!n:a.reference=n,a.position_x=o.x,a.position_y=o.y;break;case!o&&!!n:a.reference=n,s=n.offset(),a.position_x=s.left+n.outerHeight(),a.position_y=s.top;break;case!!o&&!n:a.position_x=o.x,a.position_y=o.y}n&&!i&&e(n).data("vakata_contextmenu")&&(i=e(n).data("vakata_contextmenu")),e.vakata.context._parse(i)&&a.element.html(a.html),a.items.length&&(a.element.appendTo("body"),r=a.element,c=a.position_x,l=a.position_y,d=r.width(),u=r.height(),h=e(window).width()+e(window).scrollLeft(),f=e(window).height()+e(window).scrollTop(),t&&(c-=r.outerWidth(),c<e(window).scrollLeft()+20&&(c=e(window).scrollLeft()+20)),c+d+20>h&&(c=h-(d+20)),l+u+20>f&&(l=f-(u+20)),a.element.css({left:c,top:l}).show().find("a").first().focus().parent().addClass("vakata-context-hover"),a.is_visible=!0,e.vakata.context._trigger("show"))},hide:function(){a.is_visible&&(a.element.hide().find("ul").hide().end().find(":focus").blur().end().detach(),a.is_visible=!1,e.vakata.context._trigger("hide"))}},e(function(){t="rtl"===e("body").css("direction");var n=!1;a.element=e("<ul class='vakata-context'></ul>"),a.element.on("mouseenter","li",function(t){t.stopImmediatePropagation(),e.contains(this,t.relatedTarget)||(n&&clearTimeout(n),a.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),e(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),e.vakata.context._show_submenu(this))}).on("mouseleave","li",function(t){e.contains(this,t.relatedTarget)||e(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(){e(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),e.vakata.context.settings.hide_onmouseleave&&(n=setTimeout(function(){return function(){e.vakata.context.hide()}}(this),e.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(t){t.preventDefault(),e(this).blur().parent().hasClass("vakata-context-disabled")||e.vakata.context._execute(e(this).attr("rel"))===!1||e.vakata.context.hide()}).on("keydown","a",function(t){var n=null;switch(t.which){case 13:case 32:t.type="mouseup",t.preventDefault(),e(t.currentTarget).trigger(t);break;case 37:a.is_visible&&(a.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 38:a.is_visible&&(n=a.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),n.length||(n=a.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),n.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 39:a.is_visible&&(a.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 40:a.is_visible&&(n=a.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),n.length||(n=a.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),n.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 27:e.vakata.context.hide(),t.preventDefault()}}).on("keydown",function(e){e.preventDefault();var t=a.element.find(".vakata-contextmenu-shortcut-"+e.which).parent();t.parent().not(".vakata-context-disabled")&&t.click()}),e(document).on("mousedown.vakata.jstree",function(t){a.is_visible&&!e.contains(a.element[0],t.target)&&e.vakata.context.hide()}).on("context_show.vakata.jstree",function(){a.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),t&&a.element.addClass("vakata-context-rtl").css("direction","rtl"),a.element.find("ul").hide().end()})})}(e))});